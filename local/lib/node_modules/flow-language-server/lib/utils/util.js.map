{"version":3,"sources":["../../src/utils/util.js"],"names":["filePathToURI","fileURIToPath","hasFlowPragma","flowSeverityToLSPSeverity","lspPositionToAtomPoint","atomPointToLSPPosition","atomRangeToLSPRange","lspRangeToAtomRange","compareLspPosition","compareLspRange","FlowSeverity","Error","Warning","flowSeverityToLSPSeverityMap","FILE_PROTOCOL","filePath","process","platform","file","toString","encodeURI","replace","fileUri","parse","fsPath","startsWith","localPath","slice","length","substr","content","hasPragma","test","flowSeverity","lspPosition","line","character","atomPoint","row","column","atomRange","start","end","lspRange","a","b"],"mappings":"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","file":"util.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @flow\n * @format\n */\n\nimport type {\n  DiagnosticSeverityType,\n  IPosition,\n  IRange,\n} from 'vscode-languageserver-types';\n\nimport {Point} from 'simple-text-buffer';\n\nimport {DiagnosticSeverity} from 'vscode-languageserver-types';\nimport invariant from 'assert';\nimport nullthrows from 'nullthrows';\nimport URI from 'vscode-uri';\n\nconst FlowSeverity = {\n  Error: 'Error',\n  Warning: 'Warning',\n};\n\nconst flowSeverityToLSPSeverityMap: {\n  [string]: DiagnosticSeverityType,\n} = {\n  [FlowSeverity.Error]: DiagnosticSeverity.Error,\n  [FlowSeverity.Warning]: DiagnosticSeverity.Warning,\n};\n\nconst FILE_PROTOCOL = 'file://';\n\n// On Windows, vscode-uri converts drive paths to lowercase,\n// which Flow doesn't like very much.\n// We'll implement our own basic converters `filePathToURI` and\n// `fileURIToPath`.\n\nexport function filePathToURI(filePath: string): string {\n  if (process.platform !== 'win32') {\n    return URI.file(filePath).toString();\n  }\n\n  return encodeURI(FILE_PROTOCOL + '/' + filePath.replace(/\\\\/g, '/'));\n}\n\nexport function fileURIToPath(fileUri: string): string {\n  if (process.platform !== 'win32') {\n    return URI.parse(fileUri).fsPath;\n  }\n\n  invariant(fileUri.startsWith(FILE_PROTOCOL), 'Must pass a valid file URI');\n\n  let localPath = fileUri.slice(FILE_PROTOCOL.length);\n  // Remove the leading slash and convert to backslashes.\n  if (localPath.startsWith('/')) {\n    localPath = localPath.substr(1);\n  }\n  return localPath.replace(/\\//g, '\\\\');\n}\n\nexport function hasFlowPragma(content: string) {\n  const hasPragma =\n    content.startsWith('/* @flow */') ||\n    content.startsWith('// @flow\\n') ||\n    /^\\s*\\/\\*+\\s*@flow\\s*\\*+\\//m.test(content) ||\n    /^\\s*\\/\\/\\s*@flow\\s*$/m.test(content);\n  return hasPragma;\n}\n\nexport function flowSeverityToLSPSeverity(\n  flowSeverity: string,\n): DiagnosticSeverityType {\n  invariant(\n    flowSeverity === FlowSeverity.Warning ||\n      flowSeverity === FlowSeverity.Error,\n    'must be a valid flow severity',\n  );\n\n  return nullthrows(flowSeverityToLSPSeverityMap[flowSeverity]);\n}\n\nexport function lspPositionToAtomPoint(lspPosition: IPosition): atom$Point {\n  return new Point(lspPosition.line, lspPosition.character);\n}\n\nexport function atomPointToLSPPosition(atomPoint: atom$PointObject): IPosition {\n  return {\n    line: atomPoint.row,\n    character: atomPoint.column,\n  };\n}\n\nexport function atomRangeToLSPRange(atomRange: atom$Range): IRange {\n  return {\n    start: atomPointToLSPPosition(atomRange.start),\n    end: atomPointToLSPPosition(atomRange.end),\n  };\n}\n\nexport function lspRangeToAtomRange(lspRange: IRange): atom$RangeObject {\n  return {\n    start: lspPositionToAtomPoint(lspRange.start),\n    end: lspPositionToAtomPoint(lspRange.end),\n  };\n}\n\nexport function compareLspPosition(a: Position, b: Position): number {\n  return a.line - b.line || a.character - b.character;\n}\n\nexport function compareLspRange(a: IRange, b: IRange): number {\n  return (\n    compareLspPosition(a.start, b.start) || compareLspPosition(a.end, b.end)\n  );\n}\n"]}